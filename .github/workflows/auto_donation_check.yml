
# File: .github/workflows/auto_donation_check.yml

name: Daily Donation Checker

on:
  schedule:
    # Cháº¡y má»—i ngÃ y lÃºc 16:40 UTC. TÆ°Æ¡ng Ä‘Æ°Æ¡ng 23:40 ICT (GMT+7)
    - cron: '40 16 * * *' 
  workflow_dispatch: # Cho phÃ©p báº¡n báº¥m nÃºt Run thá»§ cÃ´ng trÃªn trang GitHub
  
# ğŸ’¡ THÃŠM KHá»I NÃ€Y VÃ€O ÄÃ‚Y ğŸ’¡
permissions:
  contents: write # Cáº¥p quyá»n ghi (write) cho ná»™i dung (contents) cá»§a Repository
  
jobs:
  check-and-commit:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          # Cáº§n token Ä‘á»ƒ Ä‘á»c file history.json vÃ  commit láº¡i
          token: ${{ secrets.GITHUB_TOKEN }} 
          
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          
      # CÃ i Ä‘áº·t thÆ° viá»‡n node-fetch (dÃ¹ng Ä‘á»ƒ gá»i API)
      - name: Install dependencies
        run: npm install node-fetch

      - name: Execute Donation Checker Script
        run: node donation_checker.js
        env:
          # Äáº·t biáº¿n mÃ´i trÆ°á»ng cho script
          API_DOMAIN: cmangax8.com 

      - name: Commit and Push Changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          # Chá»‰ commit náº¿u file donation_history.json bá»‹ thay Ä‘á»•i
          file_pattern: donation_history.json
          commit_message: "Auto: Update daily donation history"
          branch: main # Thay tháº¿ báº±ng tÃªn branch chÃ­nh cá»§a báº¡n (main/master)
